{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Company","text":"<p>We are an Estonia-based IT consulting and administration team. Our main objective is to manage Linux based infrastructure. We have solid competence to manage Openstack cloud, Ceph storage, Vyos firewall clusters and network between those components. Like any good system administrator, we have long-term experiences, from plain software bugs to total system blackouts.  </p> Generic information <p>Business name:  Wirt O\u00dc e-mail:     info@wirt.ee  Register code:  16986693   IBAN (LHV): EE867700771010370923  SSH public key</p>"},{"location":"notes/","title":"Overview","text":""},{"location":"notes/#four-pillars-for-it-sadness","title":"Four pillars for IT sadness!","text":"<p>This section contains opinionated notes extracted from /dev/random.</p>"},{"location":"notes/#compute-nodes","title":"Compute nodes","text":"<p>If it breaks or gets its upgrade, it is used and abused over and over to get out of as many ticks per cycle as possible. It is not a pet, even if it paid your kid's kindergarten and schooling and your own leisure time. And if it is worked many times over its expected lifetime, you try to sell its parts to recover some utilization costs. Totally underrated piece of everything that ships with cardboard coffins.</p>"},{"location":"notes/#networks-and-overlays","title":"Networks and overlays","text":"<p>In the good old days, there was a VLAN. And that's it.  Now, everything is on top of every other thing. Everyone expects excellent dual-stack performance, and MTU keeps shrinking.  Networking is so SDN that we tend to separate networks into \"hard\" and \"soft\". Soft networking is generated, and a hard network is something you type in with your fingertips to the switch console. Luckily, the physical network is still what it was. Only high-speed optic power consumption has blown through the roof. </p>"},{"location":"notes/#storage-tiers","title":"Storage tiers","text":"<p>A not long time ago, there were local storage, RAID and NAS/SAN boxes for LUNs you hacked together with LVM to get perf numbers for your DBA, who hates you. Now, it's shared erasure encoded multiprotocol mesh with online upgrades and failure domains. And if it explodes, you can keep all the pieces. And DBA still complains about service time. Regarding storage tearing and archival: \"King Tape is dead. Long live the King Tape.\" Sometimes, if you need to Petabyte your backyard, vendor lock is not a bad thing. Speaking about open source, it's worth mentioning that things are complicated, and sometimes, support contracts or wise men from the mountaintop are needed.  On a bad day, You take a half-block size 4M object and go on a pilgrimage. If it's a bad day on steroids, you can consult with your system administrator, e.g. with yourself.</p>"},{"location":"notes/#chaos-monkeys-eg-system-administratorsdevops","title":"Chaos monkeys (e.g. system administrators/DevOps)","text":"<p>We, I, are still the same. Old busted hardware, biased problem assessments, gut-based technology selections behind L1 support and paywall, and no repo-based CI. But this gut-based decision process still beats state-of-the-art language models. Of course, this \"Thing\" is a good company for a man who was brick-walled in with IBM's mainframe.</p>"},{"location":"notes/compute/","title":"Compute","text":""},{"location":"notes/compute/#hyperconverged-infrastructure","title":"Hyperconverged infrastructure","text":"<p>Everyone wants their cake and wants to eat it too. Expecialy when you have around 100 cores per multisocet socet machine with few TB of RAM loaded with tens of TB NVMEs. Request to get a shared cluster of everything is not so uncommon.  </p>"},{"location":"notes/compute/#numa","title":"NUMA","text":"<p>To avoid interfering with different services, it seems plausible to sort the running process. It also disciplines rouge clients and helps service providers with QOS management. Also, if it's overcommitted, it's much easier to communicate why things are slow.  </p> <pre><code>ps aux  | grep libvirt  | grep -v grep | awk '{print$2}' | while read line; do \n    echo taskset -cp \"${vm0}-${numa0_end},${vm1}-${numa1_end},${vm2}-${numa2_end},${vm3}-${numa3_end}\" \"${line}\"; done | sh 1&gt;/dev/null\n\nvirsh list  | awk '/inst/ {print $2}' | while read l;do \n    for i in $(seq 0 $(virsh dominfo $l |awk '/CPU\\(/ {print$2-1}')); do \n        virsh vcpupin $l $i \"${vm0}-${numa0_end},${vm1}-${numa1_end},${vm2}-${numa2_end},${vm3}-${numa3_end}\" 1&gt;/dev/null\n        #virsh vcpupin $l $i \"1-255\" 1&gt;/dev/null\n    done \ndone\n</code></pre>"},{"location":"notes/compute/#be-not-so-nice","title":"Be not so nice","text":"<p>If it waits behind storage, then the system slows down. Prioritize shared storage proceses.</p> <pre><code>ps -e -o pid,uid,ppid,pri,ni,cmd | awk '/ceph-osd/  &amp;&amp;  !/-20/ &amp;&amp; !/awk/ {print \"renice -n -20 -g\",$1,\";ionice -c 1 -n 1 -p\",$1}'  | sh\n</code></pre>"},{"location":"notes/network/","title":"Network","text":""},{"location":"notes/network/#ip-commands","title":"IP commands","text":"<p>It tends to be universal across Linux systems. If nothing else works, it is a viable option to shut down the local network manager daemon and do the configuration manually.  </p>"},{"location":"notes/network/#policy-based-routing","title":"Policy based routing","text":"<p>Sometimes machine has more than one interface. Then, it's time to decide what goes where:</p> <pre><code>ip addr add ${ip}/${mask} dev ${dev}\nip link set dev ${dev} up\ntest -z \"$(grep ut_pub /etc/iproute2/rt_tables)\" &amp;&amp; echo \"666 pub\" &gt;&gt; /etc/iproute2/rt_tables\nip rule add from ${ip} table pub\nip rule add to ${ip} table pub\nip route add default via ${gw} dev ${dev} table pub\n</code></pre>"},{"location":"notes/network/#martians","title":"Martians","text":"<p>If traffic to the interface is unexpected, you may get a silent drop. To avoid this drop, some relaxation and breathwork are needed:  </p> <pre><code>echo 1 &gt; /proc/sys/net/ipv4/conf/bond0/log_martians\nsysctl -w net.ipv4.conf.bond0.rp_filter=2\n</code></pre>"},{"location":"notes/network/#systemd-networkd","title":"Systemd networkd","text":"<p>Over the years, every new distro upgrade has introduced some new ways to configure your network.  The situation was so bad that adding ip commands directly to the crontab @reboot line was quite common.  It was a pleasant surprise that the networkd actually worked and did not cause brain damage when configured. </p> <pre><code>cat  /etc/systemd/network/bond.network\n[Match]\nName=eno3*\n\n[Network]\nBond=bond0\n\ncat /etc/systemd/network/bond0.netdev\n[NetDev]\nName=bond0\nDescription=LAG/Bond to a switch\nKind=bond\nMACAddress=aa:aa:aa:aa:aa:aa\n\n[Bond]\nMode=802.3ad\nMIIMonitorSec=1\nLACPTransmitRate=slow\n\ncat /etc/systemd/network/bond0.network \n[Match]\nName=bond0\n\n[Network]\nVLAN=bond0.&lt;vlan tag&gt;\n\ncat /etc/systemd/network/bond0.&lt;vlan tag&gt;.netdev \n[NetDev]\nName=bond0.&lt;vlan tag&gt;\nKind=vlan\n\n[VLAN]\nId=&lt;vlan tag&gt;\n\ncat /etc/systemd/network/bond0.&lt;vlan tag&gt;.network\n[Match]\nName=bond0.&lt;vlan tag&gt;\n\n[Network]\nDHCP=yes\n</code></pre>"},{"location":"notes/storage/","title":"Storage","text":""},{"location":"notes/storage/#disk-destroyer","title":"Disk Destroyer","text":"<p>There is no better tool to arrange your bits to oblivian. But if a precise cut is needed, some commands are more valuable than others. If your specific block size calculation is incorrect, you will lose your data!</p>"},{"location":"notes/storage/#raid","title":"RAID","text":"<p>Metadata information is usually at the end of the device. If you want to re-use the device, you need to wipe it out. You have the option to wait and overwrite the entire disk:</p> <pre><code>root@demo:~# dd if=/dev/zero of=/dev/sdX bs=1M status=progress\n</code></pre> <p>Or zero out only parts Raid controller bothers to check:</p> <pre><code>root@demo:~# DEV='/dev/sdX'; dd if=/dev/zero of=$DEV bs=512 seek=$(( $(blockdev --getsz $DEV) - 1024 )) count=1024\n</code></pre>"},{"location":"notes/storage/#software-raid-and-uefi","title":"Software RAID and UEFI","text":"<p>If RAID card is not present but you need FAT for EFI boot and some redundancy:  </p> <pre><code>/dev/sda1 is efi and /dev/sdb1 is empty\nroot@demo:~# dd if=/dev/sda1 of=/dev/sdb1\nroot@demo:~# mkdir /boot/efi2\nroot@demo:~# blkid /dev/sda1\n/dev/sda1: UUID=\"xxxx-xxxx\" TYPE=\"vfat\" PARTUUID=\"xxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx\"\nroot@demo:~# blkid /dev/sdb1\n/dev/sdb1: UUID=\"xxxx-xxxx\" TYPE=\"vfat\" PARTUUID=\"yyyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyy\"\nroot@demo:~# cat /etc/fstab  | grep efi\nPARTUUID=xxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx  /boot/efi       vfat    umask=0077      0       1\nPARTUUID=xxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx  /boot/efi2      vfat    umask=0077      0       1\nroot@demo:~# efibootmgr -c -d /dev/sdb -p 1 -L \"Ubuntu-AltDrv\" -l '\\EFI\\ubuntu\\shimx64.efi'\n</code></pre>"},{"location":"notes/storage/#copy-block-device-over-network","title":"Copy block device over network","text":"<p>Let's assume you already have a healthy dose of SSH in your bloodstream. Copy block device /dev/sdX content from one machine to another machine /dev/sdY with the command:</p> <pre><code>root@demo:~# ssh root@source.example \"dd if=/dev/sdX\" bs=1M | dd of=/dev/sdY bs=1M\n</code></pre>"},{"location":"notes/storage/#swap-to-the-resque","title":"Swap to the resque","text":"<p>If you constantly get OOM killed and are happy to run your system randomly on glacier speed, then you can virtually add some RAM on the fly. 'pv' may be needed to avoid killing already slow storage. Example how to add 32G to swap:   </p> <pre><code>root@demo:~# dd if=/dev/zero | pv --rate-limit 60m | dd iflag=fullblock of=/swapfile bs=1G count=32 #32G swap\nroot@demo:~# dd if=/dev/zero of=/swapfile bs=4k count=8388608\nroot@demo:~# mkswap /swapfile\nroot@demo:~# chmod 0600 /swapfile\nroot@demo:~# /sbin/swapon /var/swapfile; #'swapoff' if needed\n</code></pre>"},{"location":"notes/storage/#get-ceph-backup","title":"Get CEPH backup","text":"<p>It is great when you have a backup or you don't destroy your network under an erasure-coded pool.</p> <pre><code>rbd export -p  pool volume-ad0ceef0-64ef-4050-afd6-3a12c13dd6be ./volume-ad0ceef0-64ef-4050-afd6-3a12c13dd6be.bac\n</code></pre>"},{"location":"notes/storage/#restore-ceph-from-backup","title":"Restore CEPH from backup","text":"<pre><code>rbd rm pool volume-ad0ceef0-64ef-4050-afd6-3a12c13dd6be\nrbd import ./volume-ad0ceef0-64ef-4050-afd6-3a12c13dd6be.bac  pool/volume-ad0ceef0-64ef-4050-afd6-3a12c13dd6be\n</code></pre>"},{"location":"profile/","title":"Profile","text":""},{"location":"profile/#purpose","title":"Purpose","text":"<p>We are riht pick in those situations where technical expertise is needed, but the requestor has nothing to do and doesn't want to know anything about academic infrastructure. Then we have a few options:  </p> <ul> <li>Convince business owners to work with academia </li> <li>Offer services for free (not likely , but one can hope) or denay request</li> <li>Use this compays governing body to provide the requested service   </li> </ul>"},{"location":"profile/#team","title":"Team","text":"<p>Academia PhD graded, well paid technical support personnel. We politely refuse when a conflict of interest or massive academic infrastructure suits you better.  </p>"},{"location":"profile/#requests","title":"Requests","text":"<p>info@wirt.ee in English or Estonian. This page language reflects the default server LOCALE. It's hard to invent terminology or quote everything.</p>"},{"location":"profile/#pricing","title":"Pricing","text":"<p>Same as academia officials, usually reviewed yearly.</p>"}]}